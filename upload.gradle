apply plugin: 'java'
apply plugin: 'maven-publish'

artifacts {
	archives(tasks.shadowJar) {
		classifier 'shadow'
		builtBy tasks.shadowJar
	}
}

buildscript {
	repositories {
		mavenCentral()
	}
	dependencies {
		classpath 'com.amazonaws:aws-java-sdk:1.11.236'
	}
}

publishing {
	publications {
		mavenJava(MavenPublication) {
			artifact shadowJar {
				classifier "shadow"
			}
		}
	}
	repositories {
		maven {
			url "s3://maven.datavorelabs.com/${project.version.endsWith('-SNAPSHOT') ? 'snapshots' : 'releases'}"
			credentials(AwsCredentials) {
				def defaultCredentials = new com.amazonaws.auth.DefaultAWSCredentialsProviderChain().getCredentials()
				accessKey defaultCredentials.getAWSAccessKeyId()
				secretKey defaultCredentials.getAWSSecretKey()
			}
		}
	}
}
